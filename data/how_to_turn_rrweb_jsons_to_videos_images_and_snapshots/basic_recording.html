<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>rrweb Basic Recording Example</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    
    button {
      padding: 10px 16px;
      font-size: 16px;
      border-radius: 4px;
      border: 1px solid #ccc;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .recording {
      background-color: #f44336;
      color: white;
    }
    
    #status {
      margin-top: 5px;
      font-size: 14px;
    }
    
    .recording-status {
      color: #f44336;
    }
    
    .stopped-status {
      color: green;
    }
  </style>
</head>
<body>
  <h1>rrweb Recording Example</h1>
  
  <button id="recordButton">Start Recording</button>
  <div id="status">Ready to record</div>
  
  <div id="eventsOutput" style="margin-top: 20px; display: none;">
    <h3>Recorded Events (JSON):</h3>
    <pre id="eventsJson" style="height: 200px; overflow: auto; border: 1px solid #ccc; padding: 10px; background: #f5f5f5;"></pre>
  </div>
  
  <!-- Load rrweb from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/rrweb@latest/dist/rrweb.min.js"></script>
  
  <script>
    // Global variables
    let events = [];
    let stopFn = null;
    let updateInterval = null;
    let isRecording = false;
    
    // DOM Elements
    const recordButton = document.getElementById('recordButton');
    const statusElement = document.getElementById('status');
    const eventsOutput = document.getElementById('eventsOutput');
    const eventsJson = document.getElementById('eventsJson');
    
    // Function to toggle recording state
    function toggleRecording() {
      if (!isRecording) {
        // Start recording
        events = []; // Clear previous events
        
        // Update UI
        recordButton.textContent = 'Stop Recording';
        recordButton.classList.add('recording');
        statusElement.textContent = 'Recording in progress... (0 events)';
        statusElement.className = 'recording-status';
        
        // Start rrweb recording
        stopFn = rrweb.record({
          emit(event) {
            events.push(event);
          },
        });
        
        // Update event count periodically
        updateInterval = setInterval(() => {
          statusElement.textContent = `Recording in progress... (${events.length} events)`;
        }, 1000);
        
        isRecording = true;
      } else {
        // Stop recording
        if (stopFn) {
          stopFn();
          stopFn = null;
        }
        
        if (updateInterval) {
          clearInterval(updateInterval);
          updateInterval = null;
        }
        
        // Update UI
        recordButton.textContent = 'Start Recording';
        recordButton.classList.remove('recording');
        statusElement.textContent = `Recording stopped. ${events.length} events captured.`;
        statusElement.className = 'stopped-status';
        
        // Display captured events
        if (events.length > 0) {
          eventsOutput.style.display = 'block';
          eventsJson.textContent = JSON.stringify(events, null, 2).substring(0, 1000) + '... (truncated)';
          
          // Store in localStorage (optional)
          try {
            localStorage.setItem('rrweb-events', JSON.stringify(events));
            console.log('Events saved to localStorage');
          } catch (e) {
            console.error('Failed to save events to localStorage:', e);
          }
        }
        
        isRecording = false;
      }
    }
    
    // Event listeners
    recordButton.addEventListener('click', toggleRecording);
    
    // Cleanup on page unload
    window.addEventListener('beforeunload', () => {
      if (stopFn) {
        stopFn();
      }
      if (updateInterval) {
        clearInterval(updateInterval);
      }
    });
  </script>
</body>
</html> 